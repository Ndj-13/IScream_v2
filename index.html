<!DOCTYPE html>
<html lang ="es">
    <head>
        <meta charset="UTF-8">
        <!--meta http-equiv="X-UA-Compatible" content="IE=edge"-->
        <title>IScream vol.2</title>
        <script src="https://cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
        <style type="text/css">
            body{
                margin: 0;
            }
        </style>

        <link rel="stylesheet" media="all" href="src/css/stylesheet.css">
        
    </head>

    <body style="text-align: center">

        <div id="introTextoP1">
            <input id="namebar" name="player1T" class="nk-namebar-input" type="text" placeholder="Introduce your name...">
            <!--input id="namebar2" name="player2T" class="nk-namebar-input" type="text" placeholder="Introduce your name..."-->
            <span class="nk-namebar-indicator"></span>
        </div>
        
        <!--script type="text/javascript" src="src/js/game.js"></script-->
        <script type="text/javascript">

            var LoadScreen = new Phaser.Class({
                Extends: Phaser.Scene,

                initialize:

                    function LoadScreen(){
                        Phaser.Scene.call(this, {key:'LoadScreen'});
                    },

                preload: function(){
                    this.load.image('logo', 'resources/img/interface/BakeryStudiosLogo.png');

                    let loadingBar = this.add.graphics({
                        fillStyle: {
                            color: 0xde72ca
                        }
                    })
                    this.load.image('loading', 'resources/img/interface/cabezaMorada.png');

                    //Barra de carga
                    this.load.on("progress", (percent)=>{
                        this.time.delayedCall(1000, () => {
                        loadingBar.fillRect(100, 350, 600*percent, 40);
                        console.log(percent);
                        });
                    })
                    this.load.on("complete", ()=>{
                        console.log('done');
                    })
                },
                create: function()
                {
                    this.add.image(400, 300, 'logo');
                    this.helado = this.add.image(100, 370, 'loading');
                    this.helado.setScale(1.3);
  
                    this.time.delayedCall(2000, () => {
                        this.scene.start('HomeScreen');
                    });
                },
                update: function(){

                }
            });

            var HomeScreen = new Phaser.Class({
                Extends: Phaser.Scene,

                initialize:

                function HomeScreen(){
                    Phaser.Scene.call(this, {key:'HomeScreen'});
                },

                preload: function(){
                    this.load.image('background', 'resources/img/interface/pantallaInicio.png');
                    this.load.image('title', 'resources/img/interface/LogoI-ScreamFondoBlanco.png');
                    this.load.spritesheet('playButton',
                        'resources/img/interface/playbutton.png',
                        { frameWidth: 64, frameHeight: 47 });
                    this.load.image('markbox', "resources/img/interface/recuadroBoton.png");
                },
                create: function(){
                    this.add.image(400, 300, 'background');
                    this.add.image(game.renderer.width/2, 200, 'title');


                    this.playButton = this.add.sprite(400, 425, "playButton").setInteractive().setScale(2.5);
                    this.markbox = this.add.image(400, 425, 'markbox').setVisible(false);
                    //this.markbox.setScale(1.2);

                    //Interaccion botones
                    this.playButton.on("pointerover", ()=>{
                        document.body.style.cursor = "pointer";
                        this.markbox.setVisible(true);
                    })

                    this.playButton.on("pointerout", ()=>{
                        document.body.style.cursor = "auto";
                        this.markbox.setVisible(false);
                    })

                    this.playButton.on("pointerdown", ()=>{
                        this.playButton.setFrame(1);
                        this.markbox.setVisible(false);
                    })

                    this.playButton.on("pointerup", ()=>{
                        document.body.style.cursor = "auto";
                        this.scene.start("CharacterSelect");
                    })
                },
                update: function(){

                }
            })

            var CharacterSelect = new Phaser.Class({
                Extends: Phaser.Scene,

                initialize:

                function CharacterSelect(){
                    Phaser.Scene.call(this, {key:'CharacterSelect'});
                },

                preload: function(){
                    this.load.image("selectScreenBg", "resources/img/interface/pantallaSeleccion.png");
                    this.load.image('markbox', "resources/img/interface/recuadroBoton.png"); //REPE
                    this.load.image("chMarkbox", "resources/img/interface/eleccionPersonaje.png");
                    //Aceptar
                    this.load.spritesheet('ok',
                        'resources/img/interface/botonOk.png',
                        { frameWidth: 120, frameHeight: 47 });
                    //Menu
                    this.load.spritesheet('menu',
                        'resources/img/interface/botonMenu.png',
                        { frameWidth: 120, frameHeight: 47 });
                    //Play
                    /*this.load.spritesheet('play',
                        'resources/img/interface/BotonPlay.png',
                        { frameWidth: 120, frameHeight: 47 });*/

                    this.load.spritesheet('player1',
                        'resources/img/players/SpritesheetP1(Andar).png',
                        { frameWidth: 64, frameHeight: 64 });
                    
                    
                },
                create: function(){
                    this.add.image(400, 300, 'selectScreenBg');
  
                    //Recuadro personaje 1
                    this.rec = this.add.image(225, 250, "chMarkbox");
                    this.rec.setScale(3.5);
  
                    //Personaje 1
                    this.player1 = this.add.sprite(225, 250, 'player1').setInteractive();
                    this.player1.setFrame(3);
                    this.player1.setScale(3);

                    document.getElementById("namebar").style.visibility = "visible";
                    //this.text1.style.marginLeft = '-130px';

                    this.ok1 = this.add.sprite(225, 450, "ok").setInteractive(); 
                    //CAMBIARIA EL OK POR UN READY Y CUANDO ESTEN TODOS READY QUE PASE A LA ESCENA DE JUGAR 

                    this.markbox1 = this.add.image(225, 450, 'markbox').setVisible(false);
                    this.markbox1.setScale(1.2);

                    //Boton menu: volver al menu
                    this.menu = this.add.sprite(100, 80, "menu").setInteractive();
                    this.marcoMenu = this.add.image(695, 525, 'marco').setVisible(false);

                    //Boton play
                    this.play = this.add.sprite(695, 480, "playButton").setInteractive();
                    this.play.setVisible(false);
                    this.marcoPlay = this.add.image(695, 480, 'marco').setVisible(false);

                    //FUNCIONALIDAD
                    this.anims.create({
                        key: 'pose',
                        frames: this.anims.generateFrameNumbers('player1', {start: 0, end: 4}),
                        frameRate: 10,
                        repeat: -1
                    })

                    this.ok1.on("pointerover", ()=>{
                        document.body.style.cursor = "pointer";
                        this.markbox1.setVisible(true);    
                    })
                    this.ok1.on("pointerout", ()=>{
                        document.body.style.cursor = "auto";
                        this.markbox1.setVisible(false);
                    })
                    this.ok1.on("pointerdown", ()=>{
                        this.markbox1.setVisible(false);
                        this.ok1.setFrame(1);
                        player1T = document.getElementById("namebar");
                        if(player1T.value == null) document.getElementById("namebar").value = "Player1";
                        console.log("Player:"+ player1T.value);
                        player1T.disabled = true;
                    })
                    this.ok1.on("pointerup", ()=>{
                        document.body.style.cursor = "auto";
                        this.scene.start('MainGame');
                        this.ok1.disableInteractive();
                        player1T.style.visibility = "hidden";
                        
                    })
  
                    /*menu:
                    this.menu.on("pointerover", ()=>{
                        document.body.style.cursor = "pointer";
                        //this.marcoMenu.setVisible(true);
                    })
                    this.menu.on("pointerout", ()=>{
                        document.body.style.cursor = "auto";
                        //this.marcoMenu.setVisible(false);
                    })
                    this.menu.on("pointerdown", ()=>{
                        //this.marcoMenu.setVisible(false);
                        this.menu.setFrame(1);
                    })
                    this.menu.on("pointerup", ()=>{
                        document.body.style.cursor = "auto";
                        this.scene.start("MainScreen");
                    })*/
                    

                },
                update: function(){
                    //Animacion personajes en pausa
                    this.player1.anims.play('pose', true);
                }
            })

            var MainGame = new Phaser.Class({
                Extends: Phaser.Scene,

                initialize:

                function MainGame(){
                    Phaser.Scene.call(this, {key:'MainGame'});
                },

                preload: function(){
                },
                create: function(){
                    console.log("Hola");
                },
                update: function(){

                }
            })

            var config = {
                type: Phaser.AUTO,
                width: 800,
                height: 600,
                pixelArt: true,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: {y: 0},
                        debug: false
                    }
                },
        
                backgroundColor: '#5B2970',
        
                /*scene: {
                    preload: preload,
                    create: create,
                    update: update
                }*/
                scene: [LoadScreen, HomeScreen, CharacterSelect, MainGame]
            };
        
            var game = new Phaser.Game(config);
            
            
        </script>
        
    </body>
</html>